<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Documentation for Triage.">
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Upgrading Experiment to v5 - Triage Documentation</title>
        <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.3.7.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
         
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Triage Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Experiment Documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../defining/">Defining an Experiment</a>
                        </li>
                    
                        <li >
                            <a href="../running/">Running an Experiment</a>
                        </li>
                    
                        <li >
                            <a href="../temporal-validation/">Temporal Validation Deep Dive</a>
                        </li>
                    
                        <li >
                            <a href="../features/">Feature Definition Deep Dive</a>
                        </li>
                    
                        <li >
                            <a href="../algorithm/">Experiment Algorithm</a>
                        </li>
                    
                        <li >
                            <a href="../architecture/">Experiment Architecture</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Upgrading Experiment to v5</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                    <li >
                        <a rel="next" href="../architecture/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="prev" >
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                <li>
                    <a href="http://github.com/dssg/triage/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="row">
                    <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
      
    
        <li class="main active"><a href="#upgrading-your-experiment-configuration-to-v5">Upgrading your experiment configuration to v5</a></li>
        
            <li><a href="#state_config-cohort_config">state_config -&gt; cohort_config</a></li>
        
            <li><a href="#label_config">label_config</a></li>
        
            <li><a href="#model_group_keys">model_group_keys</a></li>
        
            <li><a href="#upgrading-the-experiment-config-version">Upgrading the experiment config version</a></li>
        
    
    
    </ul>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="upgrading-your-experiment-configuration-to-v5">Upgrading your experiment configuration to v5<a class="headerlink" href="#upgrading-your-experiment-configuration-to-v5" title="Permanent link">&para;</a></h2>
<p>This document details the steps needed to update a triage v3 or v4 configuration to v5, mimicing the old behavior (as opposed to taking advantage of new options) as much as possible.</p>
<p>In the experiment configuration v5, several things were changed:</p>
<ul>
<li><code>state_config</code> becomes <code>cohort_config</code>, and receives new options</li>
<li><code>label_config</code> is changed to take a parameterized query</li>
<li><code>model_group_keys</code> is changed to have more robust defaults, and values specified in the config file act as overrides for the defaults instead of additions to them.</li>
</ul>
<h3 id="state_config-cohort_config">state_config -&gt; cohort_config<a class="headerlink" href="#state_config-cohort_config" title="Permanent link">&para;</a></h3>
<p>Upgrading the state config is fairly straightforward, as no functionality was removed. The key at which the state table-based configuration can be passed has changed. Before it resided at the top-level <code>state_config</code> key, whereas now it is in the optional <code>dense_states</code> key within the top-level <code>cohort_config</code> key.</p>
<p>Old:</p>
<pre><code>state_config:
    table_name: 'states'
    state_filters:
        - 'state_one AND state_two'
        - '(state_one OR state_two) AND state_three'
</code></pre>

<p>New:</p>
<pre><code>cohort_config:
   dense_states:
        table_name: 'states'
        state_filters:
        - 'state_one AND state_two'
        - '(state_one OR state_two) AND state_three'
</code></pre>

<h3 id="label_config">label_config<a class="headerlink" href="#label_config" title="Permanent link">&para;</a></h3>
<p>The label config has had functionality changed, so there is more conversion that needs to happen. Instead of taking in an 'events' table and making assumptions suitable for inspections tasks based on that table, for transparency and flexibility this now takes a parameterized query, as well as an optional <code>include_missing_labels_in_train_as</code> boolean. Leaving out this boolean value reproduces the inspections behavior (missing labels are treated as null), so to upgrade old configurations it is not needed.</p>
<p>Old:</p>
<pre><code>events_table: 'events'
</code></pre>

<p>New:</p>
<pre><code>label_config:
    query: |
        select
        events.entity_id,
        bool_or(outcome::bool)::integer as outcome
        from events
        where '{as_of_date}' &lt;= outcome_date
            and outcome_date &lt; '{as_of_date}'::timestamp + interval '{label_timespan}'
            group by entity_id
</code></pre>

<h3 id="model_group_keys">model_group_keys<a class="headerlink" href="#model_group_keys" title="Permanent link">&para;</a></h3>
<p>The model group configuration was changed quite a bit. Before, the Experiment defined a few default grouping keys and would treat anything included in the config as additional. In practice, there were many keys that were almost always included as additional model group keys, and these are now default. There are also other keys that generally make sense if certain things are iterated on (e.g. feature groups). The goal is for most projects to simply leave out this configuration value entirely. If possible, this is the recommended route to go. But for the purposes of this guide, this change should duplicate the old behavior exactly.</p>
<p>Old (empty, using defaults):</p>
<pre><code></code></pre>

<p>New:</p>
<pre><code>model_group_keys: ['class_path', 'parameters', 'feature_names']
</code></pre>

<p>Old (more standard in practice, adding some temporal parameters):</p>
<pre><code>model_group_keys: ['label_timespan', 'as_of_date_frequency', 'max_training_history']
</code></pre>

<p>New:</p>
<pre><code>model_group_keys: ['class_path', 'parameters', 'feature_names', 'label_timespan', 'as_of_date_frequency', 'max_training_history']
</code></pre>

<h3 id="upgrading-the-experiment-config-version">Upgrading the experiment config version<a class="headerlink" href="#upgrading-the-experiment-config-version" title="Permanent link">&para;</a></h3>
<p>At this point, you should be able to bump the top-level experiment config version to v5:</p>
<p>Old:</p>
<pre><code>config_version: 'v4'
</code></pre>

<p>New:</p>
<pre><code>config_version: 'v5'
</code></pre></div>
                </div>
        </div>

    <hr>
    <footer class="container">
        
        <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
    </footer>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>
    </body>
</html>
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Upgrading your experiment configuration to v5 - Triage Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Upgrading your experiment configuration to v5";
    var mkdocs_page_input_path = "experiments/upgrade-to-v5.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Triage Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Experiment Documentation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../defining/">Defining an Experiment</a>
                </li>
                <li class="">
                    
    <a class="" href="../feature-testing/">Testing Feature Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../running/">Running an Experiment</a>
                </li>
                <li class="">
                    
    <a class="" href="../temporal-validation/">Temporal Validation Deep Dive</a>
                </li>
                <li class="">
                    
    <a class="" href="../features/">Feature Generation Recipe Book</a>
                </li>
                <li class="">
                    
    <a class="" href="../algorithm/">Experiment Algorithm</a>
                </li>
                <li class="">
                    
    <a class="" href="../architecture/">Experiment Architecture</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Triage Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Upgrading your experiment configuration to v5</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="http://github.com/dssg/triage/blob/master/docs/templates/experiments/upgrade-to-v5.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="upgrading-your-experiment-configuration-to-v5">Upgrading your experiment configuration to v5</h1>
<p>This document details the steps needed to update a triage v3 or v4 configuration to v5, mimicing the old behavior (as opposed to taking advantage of new options) as much as possible.</p>
<p>In the experiment configuration v5, several things were changed:</p>
<ul>
<li><code>state_config</code> becomes <code>cohort_config</code>, and receives new options</li>
<li><code>label_config</code> is changed to take a parameterized query</li>
<li><code>model_group_keys</code> is changed to have more robust defaults, and values specified in the config file act as overrides for the defaults instead of additions to them.</li>
</ul>
<h2 id="state_config-cohort_config">state_config -&gt; cohort_config</h2>
<p>Upgrading the state config is fairly straightforward, as no functionality was removed. The key at which the state table-based configuration can be passed has changed. Before it resided at the top-level <code>state_config</code> key, whereas now it is in the optional <code>dense_states</code> key within the top-level <code>cohort_config</code> key.</p>
<p>Old:</p>
<pre><code>state_config:
    table_name: 'states'
    state_filters:
        - 'state_one AND state_two'
        - '(state_one OR state_two) AND state_three'
</code></pre>

<p>New:</p>
<pre><code>cohort_config:
   dense_states:
        table_name: 'states'
        state_filters:
        - 'state_one AND state_two'
        - '(state_one OR state_two) AND state_three'
</code></pre>

<h2 id="label_config">label_config</h2>
<p>The label config has had functionality changed, so there is more conversion that needs to happen. Instead of taking in an 'events' table and making assumptions suitable for inspections tasks based on that table, for transparency and flexibility this now takes a parameterized query, as well as an optional <code>include_missing_labels_in_train_as</code> boolean. Leaving out this boolean value reproduces the inspections behavior (missing labels are treated as null), so to upgrade old configurations it is not needed.</p>
<p>Old:</p>
<pre><code>events_table: 'events'
</code></pre>

<p>New:</p>
<pre><code>label_config:
    query: |
        select
        events.entity_id,
        bool_or(outcome::bool)::integer as outcome
        from events
        where '{as_of_date}' &lt;= outcome_date
            and outcome_date &lt; '{as_of_date}'::timestamp + interval '{label_timespan}'
            group by entity_id
</code></pre>

<h2 id="model_group_keys">model_group_keys</h2>
<p>The model group configuration was changed quite a bit. Before, the Experiment defined a few default grouping keys and would treat anything included in the config as additional. In practice, there were many keys that were almost always included as additional model group keys, and these are now default. There are also other keys that generally make sense if certain things are iterated on (e.g. feature groups). The goal is for most projects to simply leave out this configuration value entirely. If possible, this is the recommended route to go. But for the purposes of this guide, this change should duplicate the old behavior exactly.</p>
<p>Old (empty, using defaults):</p>
<pre><code></code></pre>

<p>New:</p>
<pre><code>model_group_keys: ['class_path', 'parameters', 'feature_names']
</code></pre>

<p>Old (more standard in practice, adding some temporal parameters):</p>
<pre><code>model_group_keys: ['label_timespan', 'as_of_date_frequency', 'max_training_history']
</code></pre>

<p>New:</p>
<pre><code>model_group_keys: ['class_path', 'parameters', 'feature_names', 'label_timespan', 'as_of_date_frequency', 'max_training_history']
</code></pre>

<h2 id="upgrading-the-experiment-config-version">Upgrading the experiment config version</h2>
<p>At this point, you should be able to bump the top-level experiment config version to v5:</p>
<p>Old:</p>
<pre><code>config_version: 'v4'
</code></pre>

<p>New:</p>
<pre><code>config_version: 'v5'
</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="http://github.com/dssg/triage/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>

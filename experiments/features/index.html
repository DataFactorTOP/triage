<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Feature Generation Recipe Book - Triage Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Feature Generation Recipe Book";
    var mkdocs_page_input_path = "experiments/features.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Triage Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://dssg.github.io/dirtyduck">Dirty Duck Tutorial</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Experiment</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../defining/">Defining an Experiment</a>
                </li>
                <li class="">
                    
    <a class="" href="../feature-testing/">Testing Feature Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../running/">Running an Experiment</a>
                </li>
                <li class="">
                    
    <a class="" href="../upgrading/">Upgrading an Experiment</a>
                </li>
                <li class="">
                    
    <a class="" href="../temporal-validation/">Temporal Validation Deep Dive</a>
                </li>
                <li class="">
                    
    <a class="" href="../cohort-labels/">Cohort and Label Deep Dive</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Feature Generation Recipe Book</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#feature-generation-recipe-book">Feature Generation Recipe Book</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#age">Age</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../algorithm/">Experiment Algorithm</a>
                </li>
                <li class="">
                    
    <a class="" href="../architecture/">Experiment Architecture</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://github.com/dssg/triage/tree/master/src/triage/component/audition">Audition</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://github.com/dssg/triage/tree/master/src/triage/component/postmodeling">Postmodeling</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Triage Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Experiment &raquo;</li>
        
      
    
    <li>Feature Generation Recipe Book</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="http://github.com/dssg/triage/blob/master/docs/templates/experiments/features.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="feature-generation-recipe-book">Feature Generation Recipe Book<a class="headerlink" href="#feature-generation-recipe-book" title="Permanent link">&para;</a></h2>
<p>This document is a collection of 'collate' aggregate features that we have found useful to create in Triage that may not be apparent at first.</p>
<p>For an introduction to feature generation in Triage, refer to <a href="https://dssg.github.io/dirtyduck/#orgaae2e66">Dirty Duck Feature Generation</a></p>
<h3 id="age">Age<a class="headerlink" href="#age" title="Permanent link">&para;</a></h3>
<p>You can calculate age from a date of birth column using the <code>collate_date</code> special variable. This variable is marked as a placeholder in the feature quantity input, but is replaced with each as-of-date when features are being calculated. Combined with the Postgres <code>age</code> function, this calculates a person's age at each as-of-date as a feature.</p>
<p>For this example, let's assume you have a column called 'dob' that is a timestamp (or anything that can be cast to a date) in your source table. The <code>feature_aggregation</code>'s quantity would be: </p>
<p><code>EXTRACT(YEAR FROM AGE('{collate_date}'::DATE, dob::DATE))</code></p>
<p>If Triage is calculating this for the as-of-date '2016-01-01', it will internally expand the <code>collate_date</code> out to:
<code>EXTRACT(YEAR FROM AGE('2016-01-01'::DATE, dob::DATE))</code></p>
<p>In context, a feature aggregate that uses age may look more like:</p>
<pre><code>    aggregates:
      - # age in years 
        quantity:
          age: &quot;EXTRACT(YEAR FROM AGE('{collate_date}'::DATE, dob::DATE))&quot;
        metrics: ['max']
</code></pre>

<p>Here, we call the feature 'age' and since everything in collate is defined as an aggregate, we pick 'max'; Any records for the same person and as-of-date should have the same 'dob', so there are many aggregates you can use that will arrive at the same answer (e.g. 'min', 'avg'). In these cases 'max' is the standard aggregate metric of choice in Triage.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../algorithm/" class="btn btn-neutral float-right" title="Experiment Algorithm">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../cohort-labels/" class="btn btn-neutral" title="Cohort and Label Deep Dive"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="http://github.com/dssg/triage/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../cohort-labels/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../algorithm/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/mermaid.min.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>

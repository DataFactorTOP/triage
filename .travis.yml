dist: xenial
language: python
python: ["3.6", "3.7"]
addons:
  postgresql: '9.5'
services:
- postgresql
before_install:
- sudo apt-get update
- sudo apt-get install libblas-dev liblapack-dev libatlas-base-dev gfortran
install:
- pip install -r requirement/include/build.txt -r requirement/include/test-management.txt
env:
  matrix:
    - BOTO_CONFIG=/tmp/nowhere
  global:
    secure: PsHUI1DwmHz2+gPv5N0LZ08m+1xW1pcz216vIfVp69QOIpgRbWxxzi2p1peXjaT8dnH2RCOSRIMxey4cNnuFuK1nalRwsEIlXAv7Qt4mjQnJzdYap73v6xgPQzx1nz9f/0laqumVtmLfEN9vYqgoR3OOUMFOF6Yh9189h4j/Zar4wlEZw1OTJc4nu6ppPaqmjcZmVRtoZeNY1Ve9x4T2RCyaaVixL/4OauGccgChx56IFVlU6tfg7D3SUwqsfZnxAHZMg4sVnS505Lse9jTIeT9wTbl7WVBuaGq8P0Mxu+mkn57u7z5asPlJ0Yl9FZrlJyrkp92ZS1xdXHG//2A85DCaKqqnkHd8lCzPaQzfNmiqaHEq9Ru5bh3koOE/BFPf6iLL0yFAYLADc3NtC82B05o2JM1whWFsbsR1w/AMWMztceZXiFKYJclW7Ha/4JuTZkWFfLNdDtsAzBzTEzbeo0AyG0hJO0KYFtpVp1JvbGnFFlwovbvKTyOXzghW1txddoi2ZzgluXki6EA2+qjrbPnsRsexZ9g45R8NumbfGZV8cbaWYjdNDwES7D1tvzbvhw6xhgQENd32MsxJtsHZBoOye9BXdlEzfyqqgspJ+EHnGX6/zEOxzn785SpVXFTVhYn2oizsriXdNSsQHQcIZ8UpZx8msRu+jtg7eMMFrxo=
script: tox -e py3 src/tests/test_cli.py
notifications:
  email: false
after_success: codecov
deploy:
  -
    repo: dssg/triage
    distributions: sdist bdist_wheel
    password:
      secure: o0JpnmjqbYgu75eUXfxX/FUw0ek6Pp1bdhqRH4x3VnINy3TdBZ1tdD35B0l8L5UaR+j8LawOwTt3md3EyQTNpJQypFChcF6LDTS2hF0ZxyFphgWWo+DWhx8abAT/xAECO7Z7pjynQcYy1OAC3U+V8E7gevlr/nWD1/Le0mC+BJocJQ6QBZCD84E4ennXdLUgMqQZlCUKvi6j7EXvV4NoXbuZPaZKhC77CZ0xpEu0aQG9IPPGgkmL3a5RQd5/Uu8rlBES5lzh9bysW3NvXSUaq5XXrQAx5Fba3/lDN8aVkFvseLwOfjZ1pdTnbcDH5ti24YYecBsRsF4qmOY5pVZQZWeQRZFZ+/wp0fa34M9XjIyN7rXKyPm2UX7A8IYyF95xvniKs0qUOBXGRq5IFse6OSUIuKLYl3XjN3IPUPRCXnxoCXyRFV3NNyvtfb47+eejrgfqav9SKE5auA/t5ioQh6FuVqBMCWK7FFiZCt4z1g6RmYAFlRcTuHeedKjOfzWU79AeUoTJA1tfz4FtNjIWfoZJyCNCUCQjYzD/yCJGuDCuY/42+QGaMo9oEVgw7ublC0Xzib+zyuogTvjxYQR+XGJnCgeDYEs7A/o8CHdJKSeIbxpnuZShPpkdBQgzWmnvlfgJTYICaa10oAf5+sDnBQQsumZBT3iuKJETXIkNxeo=
    provider: pypi
    user: dssg
    on:
       repo: dssg/triage
       tags: true
  -
    provider: script
    script: python manage.py docsdeploy
    skip_cleanup: true
    on:
      branch: doc_deploy_task
      #tags: true
